<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智愈派 - 健康管理平台</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 1rem 0;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 2rem;
        }
        h1 {
            margin: 0;
        }
        .intro {
            background-color: white;
            padding: 2rem;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .api-links {
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .api-link {
            background-color: white;
            padding: 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1 1 300px;
        }
        a {
            color: #4CAF50;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>智愈派 - 健康管理平台</h1>
        </header>
        <div class="intro">
            <h2>欢迎使用智愈派API</h2>
            <p>这是一个健康数据管理平台的API服务。您可以通过以下链接访问API文档和测试接口。</p>
        </div>
        <div class="api-links">
            <div class="api-link">
                <h3>API文档</h3>
                <p>查看完整的API文档和使用说明。</p>
                <a href="/api-auth/" target="_blank">访问API文档</a>
            </div>
            <div class="api-link">
                <h3>健康数据API</h3>
                <p>访问健康数据相关的API接口。</p>
                <a href="/api/health/" target="_blank">查看健康数据API</a>
            </div>
            <div class="api-link">
                <h3>用户管理API</h3>
                <p>访问用户管理相关的API接口。</p>
                <a href="/api/users/" target="_blank">查看用户管理API</a>
            </div>
        </div>

        <div class="intro" style="margin-top: 2rem;">
            <h2>用户注册</h2>
            <form id="registerForm">
                <div style="margin-bottom: 1rem;">
                    <label for="username" style="display: block; margin-bottom: 0.5rem;">用户名（仅允许英文和数字）:</label>
                    <input type="text" id="username" name="username" required
                        style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label for="password" style="display: block; margin-bottom: 0.5rem;">密码（不允许中文，只允许字母、数字和.符号）:</label>
                    <input type="password" id="password" name="password" required
                        style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <button type="submit" style="background-color: #4CAF50; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">
                    注册
                </button>
            </form>
            <div id="registerResult" style="margin-top: 1rem; padding: 1rem; border-radius: 4px;"></div>
        </div>

        <div class="intro" style="margin-top: 2rem;">
            <h2>用户登录</h2>
            <form id="loginForm">
                <div style="margin-bottom: 1rem;">
                    <label for="loginUsername" style="display: block; margin-bottom: 0.5rem;">用户名:</label>
                    <input type="text" id="loginUsername" name="username" required
                        style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label for="loginPassword" style="display: block; margin-bottom: 0.5rem;">密码:</label>
                    <input type="password" id="loginPassword" name="password" required
                        style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <button type="submit" style="background-color: #2196F3; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer;">
                    登录
                </button>
            </form>
            <div id="loginResult" style="margin-top: 1rem; padding: 1rem; border-radius: 4px;"></div>
        </div>

        <script>
            // 处理注册表单
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const resultDiv = document.getElementById('registerResult');
                resultDiv.style.display = 'block';
                resultDiv.style.backgroundColor = '#f0f0f0';
                resultDiv.textContent = '正在注册...';

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                try {
                    const response = await fetch('/api/users/register/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ username, password }),
                      });

                    const data = await response.json();

                    if (response.ok) {
                        resultDiv.style.backgroundColor = '#dff0d8';
                        resultDiv.style.color = '#3c763d';
                        resultDiv.innerHTML = `注册成功！<br>用户ID: ${data.user_id}<br>访问令牌: ${data.tokens.access.substring(0, 20)}...`;
                        // 清空表单
                        document.getElementById('registerForm').reset();
                    } else {
                        resultDiv.style.backgroundColor = '#f2dede';
                        resultDiv.style.color = '#a94442';
                        resultDiv.textContent = `注册失败: ${data.error || '未知错误'}`;
                    }
                } catch (error) {
                    resultDiv.style.backgroundColor = '#f2dede';
                    resultDiv.style.color = '#a94442';
                    resultDiv.textContent = `请求出错: ${error.message}`;
                }
            });

            // 处理登录表单
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const resultDiv = document.getElementById('loginResult');
                resultDiv.style.display = 'block';
                resultDiv.style.backgroundColor = '#f0f0f0';
                resultDiv.textContent = '正在登录...';

                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;

                try {
                    function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const response = await fetch('/api/users/login/', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')
    },
    body: JSON.stringify({ username, password })
});

                    const data = await response.json();

                    if (response.ok) {
                        resultDiv.style.backgroundColor = '#dff0d8';
                        resultDiv.style.color = '#3c763d';
                        resultDiv.innerHTML = `登录成功！<br>用户ID: ${data.user_id}<br>访问令牌: ${data.tokens.access.substring(0, 20)}...`;
                        // 清空表单
                        document.getElementById('loginForm').reset();
                    } else {
                        resultDiv.style.backgroundColor = '#f2dede';
                        resultDiv.style.color = '#a94442';
                        resultDiv.textContent = `登录失败: ${data.error || '未知错误'}`;
                    }
                } catch (error) {
                    resultDiv.style.backgroundColor = '#f2dede';
                    resultDiv.style.color = '#a94442';
                    resultDiv.textContent = `请求出错: ${error.message}`;
                }
            });
        </script>
    </div>
</body>
</html>